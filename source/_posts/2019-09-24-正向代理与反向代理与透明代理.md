---
title: 正向代理、反向代理、透明代理
tags: [nginx, 正向代理, 反向代理, 透明代理]
toc: true
mathjax: true
date: 2019-09-24 22:56:46
categories:
    - nginx
---

## 正向代理

### 什么是正向代理

正向代理是当客户端获取源服务器的内容时，通过携带上源服务器的域名和端口号访问一个中间服务器，中间服务器接收到需要访问的源服务器域名和端口，然后请求源服务器获取内容，并将内容返回给客户端

### 正向代理的特点

1. 隐藏了客户端，客户端对于源服务器而言是不可见的
2. 代理了客户端
3. 客户端需要进行一些特别的设置
4. 由客户端决定要访问哪个源服务器，代理服务器只做转发功能

### 正向代理的应用

1. VPN应用，例如Shadowsocks在Mac中的应用，通过设置网络->网络偏好设置->高级->代理->自动代理->代理配置文件地址默认为（http://127.0.0.1:8090/proxy.pac），同时选择一个节点（比如日本1之类的，其实就是中间服务器的地址）。配置成功后，当我们访问外网，例如 https://www.google.com/ 或 https://www.facebook.com/ 时，这两个域名被包含在在proxy.pac中的rules数组中，所以会走代理，请求你选择的节点（这里为日本1）服务器，并携带上源服务器的地址（这里为 https://www.google.com/ 或 https://www.facebook.com/），然后节点服务器接收到请求后，获得你要请求的源服务器地址并发送请求，获得内容然后返回给你
2. 手机的代理功能

### 正向代理的作用

1. 访问某些不可达的服务器，例如VPN、客户端与源服务器中间的某个路由器故障导致访问不了等。
2. 加速访问服务器，这种说法不像以前那么流行了，主要是因为带宽流量的飞速发展。客户端到源服务都是低带宽链路，而客户端到代理服务器、代理服务器到源服务器都是高带宽链路，这样即加快了访问服务器的速度。
3. Cache作用。第一次访问某资源时代理服务器将资源缓存到本地，后续再次访问直接返回，不用再去请求源服务器（PS: 这不是nginx的实现原理，nginx采用的是反向代理机制）。
4. 客户端访问授权。代理服务器进行权限过滤，允许符合权限的客户端访问源服务器，否则访问源服务器时，丢弃数据包（PS: 这里还需要访问源服务器吗？）。
5. 隐藏客户端

## 反向代理

### 什么是反向代理

反向代理是客户端访问某一服务器时，这个**服务器判断**将请求转发到何处，并将获得的内容返回给客户端

### 反向代理的特点

1. 隐藏了源服务器，源服务器对于客户端是不可见的，对于客户端而言，代理服务器就相对于源服务器
2. 代理了服务器
3. 客户端不需要进行设置
4. 由代理服务器决定访问哪个源服务器

### 反向代理的应用

1. 保护和隐藏原始服务器，例如源服务器的防火墙只允许代理服务器Z进行访问，客户端只能通过访问代理服务器Z来获取源服务器的资源，并不知道源服务器的地址
2. 负载均衡，当反向代理服务器不只一个时，我们可以把它们做成集群，当更多的用户访问源服务器时，让不同的代理服务器去应答不同的用户，然后发送不同用户需要的资源（CDN技术的核心）

## 透明代理

透明代理的意思是客户端根本不需要知道有代理服务器的存在，它改编你的request fields（报文），并会传送真实IP。注意，加密的透明代理则是属于匿名代理，意思是不用设置使用代理了。

## 如何区分正向代理和反向代理

主要区别：

1. 客户端是否需要进行配置
2. 代理服务器的处理方式，是直接取得请求的地址和端口，还是携带的原地址和端口

正向代理：

客户端需要配置代理服务器的地址和端口，客户端拦截原请求，转发到代理服务器，并带上原请求的地址和端口，代理服务器取得请求携带的原地址和端口，可以直接把请求转发到原服务器或者进行配置，转发到其它服务器，例如VPN。

反向代理：

客户端请求代理服务器，服务器进行配置，根据请求内容转发到不同的源服务器，并将内容返回给客户端，例如nginx负载均衡
